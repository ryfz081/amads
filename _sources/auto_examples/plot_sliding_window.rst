
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_sliding_window.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_plot_sliding_window.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_sliding_window.py:


Sliding window analysis
=======================

This example demonstrates how to perform a sliding window analysis on a musical
score to compute the mean pitch height (mean key_num) from each window and plot
the result.

.. GENERATED FROM PYTHON SOURCE LINES 11-12

First, we'll import the required modules.

.. GENERATED FROM PYTHON SOURCE LINES 12-19

.. code-block:: Python


    import matplotlib.pyplot as plt

    from amads.algorithms.slice.window import sliding_window
    from amads.io.pt_midi_import import partitura_midi_import
    from amads.music import example








.. GENERATED FROM PYTHON SOURCE LINES 20-21

Load an example MIDI file and import it using partitura.

.. GENERATED FROM PYTHON SOURCE LINES 21-25

.. code-block:: Python


    midi_file = example.fullpath("midi/twochan.mid")
    my_score = partitura_midi_import(midi_file, ptprint=False)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:575: UserWarning: pitch spelling
      warnings.warn("pitch spelling")
    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:658: UserWarning: create_part
      part = create_part(
    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:658: UserWarning: add notes
      part = create_part(
    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:658: UserWarning: add time sigs and measures
      part = create_part(
    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:658: UserWarning: tie notes
      part = create_part(
    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:658: UserWarning: find tuplets
      part = create_part(
    /opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/partitura/io/importmidi.py:658: UserWarning: done create_part
      part = create_part(
    partitura_convert_part: after pass 1, measures are
    [(1, 0, 2400), ('timesig', 4, 4), (2, 2400, 4800), (3, 4800, 7200), (4, 7200, 9600), (5, 9600, 9601)]
    div_to_quarter: div 2400 qtrs 4.0
    div_to_quarter: div 0 qtrs 0.0
    div_to_quarter: div 4800 qtrs 8.0
    div_to_quarter: div 2400 qtrs 4.0
    div_to_quarter: div 7200 qtrs 12.0
    div_to_quarter: div 4800 qtrs 8.0
    div_to_quarter: div 9600 qtrs 16.0
    div_to_quarter: div 7200 qtrs 12.0
    div_to_quarter: div 9601 qtrs 16.0
    div_to_quarter: div 9600 qtrs 16.0
    ignoring 0-- Clef sign=G line=2 number=1
    ignoring 0--2400 Measure number=1 name=1
    ignoring 0-- TimeSignature 4/4
    div_to_quarter: div 0 qtrs 0.0
    Tempo start 0.0 tempo 1.6666666666666667
    append_beat_tempo 1.6666666666666667 <amads.core.time_map.MapBeat object at 0x7fc3d6a972b0>
    div_to_quarter: div 1 qtrs 0.0016666666666666668
    div_to_quarter: div 601 qtrs 1.0016666666666667
    div_to_quarter: div 1201 qtrs 2.0016666666666665
    div_to_quarter: div 1801 qtrs 3.0016666666666665
    div_to_quarter: div 2400 qtrs 4.0
    ignoring 2400--4800 Measure number=2 name=2
    div_to_quarter: div 2401 qtrs 4.001666666666667
    div_to_quarter: div 3001 qtrs 5.001666666666667
    div_to_quarter: div 3601 qtrs 6.001666666666667
    div_to_quarter: div 4201 qtrs 7.001666666666667
    div_to_quarter: div 4800 qtrs 8.0
    ignoring 4800--7200 Measure number=3 name=3
    div_to_quarter: div 4801 qtrs 8.001666666666667
    div_to_quarter: div 5401 qtrs 9.001666666666667
    div_to_quarter: div 6001 qtrs 10.001666666666667
    div_to_quarter: div 6601 qtrs 11.001666666666667
    div_to_quarter: div 7200 qtrs 12.0
    ignoring 7200--9600 Measure number=4 name=4
    div_to_quarter: div 7201 qtrs 12.001666666666667
    div_to_quarter: div 7801 qtrs 13.001666666666667
    div_to_quarter: div 8401 qtrs 14.001666666666667
    div_to_quarter: div 9001 qtrs 15.001666666666667
    div_to_quarter: div 9600 qtrs 16.0
    ignoring 9600--9601 Measure number=5 name=5
    BEGIN retie_note ['Note', 3.0016666666666665, 0.9983333333333333, None, 65, 'n3', True, <partitura.score.Note object at 0x7fc3d6a94190>]
    GROUP BEFORE:  [['Note', 3.0016666666666665, 0.9983333333333333, None, 65, 'n3', True, <partitura.score.Note object at 0x7fc3d6a94190>], ['Note', 4.0, 0.0016666666666666668, None, 65, 'n3a', True, <partitura.score.Note object at 0x7fc3d6a959f0>]]
    BEGIN retie_note ['Note', 4.0, 0, None, 65, 'n3a', True, <partitura.score.Note object at 0x7fc3d6a959f0>]
    BEGIN retie_note ['Note', 7.001666666666667, 0.9983333333333333, None, 71, 'n7', True, <partitura.score.Note object at 0x7fc3d6a96a40>]
    GROUP BEFORE:  [['Note', 7.001666666666667, 0.9983333333333333, None, 71, 'n7', True, <partitura.score.Note object at 0x7fc3d6a96a40>], ['Note', 8.0, 0.0016666666666666668, None, 71, 'n7a', True, <partitura.score.Note object at 0x7fc3d6a971f0>]]
    BEGIN retie_note ['Note', 8.0, 0, None, 71, 'n7a', True, <partitura.score.Note object at 0x7fc3d6a971f0>]
    BEGIN retie_note ['Note', 11.001666666666667, 0.9983333333333333, None, 71, 'n11', True, <partitura.score.Note object at 0x7fc3d6a94220>]
    GROUP BEFORE:  [['Note', 11.001666666666667, 0.9983333333333333, None, 71, 'n11', True, <partitura.score.Note object at 0x7fc3d6a94220>], ['Note', 12.0, 0.0016666666666666668, None, 71, 'n11a', True, <partitura.score.Note object at 0x7fc3d6a94be0>]]
    BEGIN retie_note ['Note', 12.0, 0, None, 71, 'n11a', True, <partitura.score.Note object at 0x7fc3d6a94be0>]
    BEGIN retie_note ['Note', 15.001666666666667, 0.9983333333333333, None, 67, 'n15', True, <partitura.score.Note object at 0x7fc3d6a97610>]
    GROUP BEFORE:  [['Note', 15.001666666666667, 0.9983333333333333, None, 67, 'n15', True, <partitura.score.Note object at 0x7fc3d6a97610>], ['Note', 16.0, 0.0016666666666666668, None, 67, 'n15a', True, <partitura.score.Note object at 0x7fc3d6a94820>]]
    BEGIN retie_note ['Note', 16.0, 0, None, 67, 'n15a', True, <partitura.score.Note object at 0x7fc3d6a94820>]
    Something is wrong; could not find measure for ['Note', 16.0, 0, None, 67, 'n15a', True, <partitura.score.Note object at 0x7fc3d6a94820>]
    partitura_convert_part: after pass 1, measures are
    [(1, 0, 2400), ('timesig', 4, 4), (2, 2400, 4800), (3, 4800, 7200), (4, 7200, 9600), (5, 9600, 9601)]
    div_to_quarter: div 2400 qtrs 4.0
    div_to_quarter: div 0 qtrs 0.0
    div_to_quarter: div 4800 qtrs 8.0
    div_to_quarter: div 2400 qtrs 4.0
    div_to_quarter: div 7200 qtrs 12.0
    div_to_quarter: div 4800 qtrs 8.0
    div_to_quarter: div 9600 qtrs 16.0
    div_to_quarter: div 7200 qtrs 12.0
    div_to_quarter: div 9601 qtrs 16.0
    div_to_quarter: div 9600 qtrs 16.0
    ignoring 0-- Clef sign=F line=4 number=1
    ignoring 0--2400 Measure number=1 name=1
    ignoring 0-- TimeSignature 4/4
    div_to_quarter: div 1 qtrs 0.0016666666666666668
    div_to_quarter: div 1201 qtrs 2.0016666666666665
    div_to_quarter: div 2400 qtrs 4.0
    ignoring 2400--4800 Measure number=2 name=2
    div_to_quarter: div 2401 qtrs 4.001666666666667
    div_to_quarter: div 3601 qtrs 6.001666666666667
    div_to_quarter: div 4800 qtrs 8.0
    ignoring 4800--7200 Measure number=3 name=3
    div_to_quarter: div 4801 qtrs 8.001666666666667
    div_to_quarter: div 6001 qtrs 10.001666666666667
    div_to_quarter: div 7200 qtrs 12.0
    ignoring 7200--9600 Measure number=4 name=4
    div_to_quarter: div 7201 qtrs 12.001666666666667
    div_to_quarter: div 8401 qtrs 14.001666666666667
    div_to_quarter: div 9600 qtrs 16.0
    ignoring 9600--9601 Measure number=5 name=5
    BEGIN retie_note ['Note', 2.0016666666666665, 1.9983333333333333, None, 43, 'n17', True, <partitura.score.Note object at 0x7fc3d6a95900>]
    GROUP BEFORE:  [['Note', 2.0016666666666665, 1.9983333333333333, None, 43, 'n17', True, <partitura.score.Note object at 0x7fc3d6a95900>], ['Note', 4.0, 0.0016666666666666668, None, 43, 'n17a', True, <partitura.score.Note object at 0x7fc3d6a97c40>]]
    BEGIN retie_note ['Note', 4.0, 0, None, 43, 'n17a', True, <partitura.score.Note object at 0x7fc3d6a97c40>]
    BEGIN retie_note ['Note', 6.001666666666667, 1.9983333333333333, None, 43, 'n19', True, <partitura.score.Note object at 0x7fc3d6a97250>]
    GROUP BEFORE:  [['Note', 6.001666666666667, 1.9983333333333333, None, 43, 'n19', True, <partitura.score.Note object at 0x7fc3d6a97250>], ['Note', 8.0, 0.0016666666666666668, None, 43, 'n19a', True, <partitura.score.Note object at 0x7fc3d6a94d60>]]
    BEGIN retie_note ['Note', 8.0, 0, None, 43, 'n19a', True, <partitura.score.Note object at 0x7fc3d6a94d60>]
    BEGIN retie_note ['Note', 10.001666666666667, 1.9983333333333333, None, 38, 'n21', True, <partitura.score.Note object at 0x7fc3d6a96d40>]
    GROUP BEFORE:  [['Note', 10.001666666666667, 1.9983333333333333, None, 38, 'n21', True, <partitura.score.Note object at 0x7fc3d6a96d40>], ['Note', 12.0, 0.0016666666666666668, None, 38, 'n21a', True, <partitura.score.Note object at 0x7fc3d6a94880>]]
    BEGIN retie_note ['Note', 12.0, 0, None, 38, 'n21a', True, <partitura.score.Note object at 0x7fc3d6a94880>]
    BEGIN retie_note ['Note', 14.001666666666667, 1.9983333333333333, None, 47, 'n23', True, <partitura.score.Note object at 0x7fc3d6a97fa0>]
    GROUP BEFORE:  [['Note', 14.001666666666667, 1.9983333333333333, None, 47, 'n23', True, <partitura.score.Note object at 0x7fc3d6a97fa0>], ['Note', 16.0, 0.0016666666666666668, None, 47, 'n23a', True, <partitura.score.Note object at 0x7fc3d6a94c70>]]
    BEGIN retie_note ['Note', 16.0, 0, None, 47, 'n23a', True, <partitura.score.Note object at 0x7fc3d6a94c70>]
    Something is wrong; could not find measure for ['Note', 16.0, 0, None, 47, 'n23a', True, <partitura.score.Note object at 0x7fc3d6a94c70>]




.. GENERATED FROM PYTHON SOURCE LINES 26-28

Set up parameters for the sliding window analysis. We'll use a window size of
4.0 (one bar) and a small step size of 0.01 for smooth results.

.. GENERATED FROM PYTHON SOURCE LINES 28-32

.. code-block:: Python


    size = 4.0  # one bar
    step = 0.01








.. GENERATED FROM PYTHON SOURCE LINES 33-34

Flatten the score to get a single sequence of notes.

.. GENERATED FROM PYTHON SOURCE LINES 34-37

.. code-block:: Python


    flattened_score = my_score.flatten(collapse=True)








.. GENERATED FROM PYTHON SOURCE LINES 38-40

Perform the sliding window analysis. Each window will contain notes that are
sounding within its time boundaries.

.. GENERATED FROM PYTHON SOURCE LINES 40-47

.. code-block:: Python


    windows = sliding_window(
        flattened_score,
        size=size,
        step=step,
        align="center",
    )







.. GENERATED FROM PYTHON SOURCE LINES 48-50

Compute the duration-weighted mean pitch height for each window.
For empty windows, we'll use None as the default value.

.. GENERATED FROM PYTHON SOURCE LINES 50-63

.. code-block:: Python

    times = []
    mean_pitch_heights = []
    for window in windows:
        times.append(window.time)

        if len(window.content) == 0:
            mean_pitch_heights.append(None)
            continue

        total_duration = sum(note.duration for note in window.content)
        weighted_sum = sum(note.key_num * note.duration for note in window.content)
        mean_pitch_heights.append(weighted_sum / total_duration)








.. GENERATED FROM PYTHON SOURCE LINES 64-65

Finally, plot the results to visualize how mean pitch height changes over time.

.. GENERATED FROM PYTHON SOURCE LINES 65-72

.. code-block:: Python


    plt.figure(figsize=(10, 6))
    plt.plot(times, mean_pitch_heights)
    plt.xlabel("Time")
    plt.ylabel("Mean pitch height")
    plt.show()




.. image-sg:: /auto_examples/images/sphx_glr_plot_sliding_window_001.png
   :alt: plot sliding window
   :srcset: /auto_examples/images/sphx_glr_plot_sliding_window_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.971 seconds)


.. _sphx_glr_download_auto_examples_plot_sliding_window.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_sliding_window.ipynb <plot_sliding_window.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_sliding_window.py <plot_sliding_window.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_sliding_window.zip <plot_sliding_window.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
