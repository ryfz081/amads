
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>amads.core.basics &#8212; amads  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/amads/core/basics';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">amads  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User guide:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide/installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer notes:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/design.html">Design considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/music21.html">Music21</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/style.html">Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_notes/making_a_release.html">Making a release</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_durdist1.html">Duration distributions (I)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_durdist2.html">Duration distributions (II)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_parncutt_root_analysis.html">Root analysis (after Parncutt)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_boundary.html">Boundary detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_sliding_window.html">Sliding window analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_melsim.html">Melodic similarity</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">General algorithms:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.algorithms.entropy.html">amads.algorithms.entropy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.algorithms.nnotes.html">amads.algorithms.nnotes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.algorithms.scale.html">amads.algorithms.scale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.algorithms.slice.salami.html">amads.algorithms.slice.salami</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.algorithms.slice.window.html">amads.algorithms.slice.window</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Pitch:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.hz2midi.html">amads.pitch.hz2midi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.ismonophonic.html">amads.pitch.ismonophonic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.ivdirdist1.html">amads.pitch.ivdirdist1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.ivdist1.html">amads.pitch.ivdist1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.ivdist2.html">amads.pitch.ivdist2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.ivsizedist1.html">amads.pitch.ivsizedist1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.key.profiles.html">amads.pitch.key.profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.pcdist1.html">amads.pitch.pcdist1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.pcdist2.html">amads.pitch.pcdist2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.pitch_mean.html">amads.pitch.pitch_mean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.pitch.transformations.html">amads.pitch.transformations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.time.durdist1.html">amads.time.durdist1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.time.durdist2.html">amads.time.durdist2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.time.swing.html">amads.time.swing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.time.tempo.html">amads.time.tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.time.meter.break_it_up.html">amads.time.meter.break_it_up</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Melody:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.melody.boundary.html">amads.melody.boundary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.melody.segment_gestalt.html">amads.melody.segment_gestalt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.melody.contour.interpolation_contour.html">amads.melody.contour.interpolation_contour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.melody.contour.step_contour.html">amads.melody.contour.step_contour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.melody.similarity.melsim.html">amads.melody.similarity.melsim</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Polyphony:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.polyphony.skyline.html">amads.polyphony.skyline</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Core:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.core.basics.html">amads.core.basics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">IO:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/amads.io.pianoroll.html">amads.io.pianoroll</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for amads.core.basics</h1><div class="highlight"><pre>
<span></span><span class="c1"># basics.py - basic symbolic music representation classes</span>
<span class="c1"># fmt: off</span>
<span class="c1"># flake8: noqa E129,E303</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Quick overview: The basic hierarchy of a score is shown here.</span>
<span class="sd">Each level of this hierarchy can contain 0</span>
<span class="sd">or more instances of the next level. Levels are optional,</span>
<span class="sd">allowing for more note-list-like representations:</span>

<span class="sd">Score (one per musical work or movement)</span>
<span class="sd">    Part (one per instrument)</span>
<span class="sd">        Staff (usually 1, but e.g. 2 for grand staff)</span>
<span class="sd">            Measure (one for each measure)</span>
<span class="sd">                (Measure can contain multiple instances of the following)</span>
<span class="sd">                Note</span>
<span class="sd">                Rest</span>
<span class="sd">                Chord</span>
<span class="sd">                    Note (one for each note of the chord)</span>
<span class="sd">                KeySignature</span>
<span class="sd">                TimeSignature</span>

<span class="sd">A &quot;flattened&quot; score looks like this:</span>

<span class="sd">Score (one per musical work or movement)</span>
<span class="sd">    Part (one per instrument)</span>
<span class="sd">        Note (no other instances allowed, no ties)</span>

<span class="sd">Score, Part, Staff, Measure, and Chord are all EventGroups and</span>
<span class="sd">their constructors can take a list of Events as their content.</span>

<span class="sd">The safe way to construct a score is to fully specify onsets</span>
<span class="sd">for every Event. These onsets are absolute and will not be adjusted</span>
<span class="sd">*provided that* the parent onset is also specified.</span>

<span class="sd">However, for convenience and to support simple constructs such as</span>
<span class="sd">  Chord(Note(pitch=60), Note(pitch=64)),</span>
<span class="sd">onsets are optional and default to None. To make this simple example</span>
<span class="sd">work:</span>
<span class="sd">1) Concurrences (Score, Part, and Chord) replace unspecified (None) </span>
<span class="sd">   onsets in their immediate content with the parent&#39;s onset (or 0</span>
<span class="sd">   if it is None).</span>
<span class="sd">2) Sequences (Staff, Measure) replace unspecified (None) onsets in</span>
<span class="sd">   their immediate content starting with the parent&#39;s onset (or 0 if </span>
<span class="sd">   None) for the first event and the offset of the previous Event for</span>
<span class="sd">   subsequent events.</span>
<span class="sd">3) To handle the construction of nested Events, when an unspecified</span>
<span class="sd">   (None) onset of an EventGroup is replaced, the entire subtree of</span>
<span class="sd">   its content is shifted by the same amount. E.g. if a Chord is</span>
<span class="sd">   constructed with Notes with unspecified onsets, the Notes onsets</span>
<span class="sd">   will initially be replaced with zeros. Then, if the Chord onset is</span>
<span class="sd">   unspecified (None) and the Chord is passed in the content of a</span>
<span class="sd">   Measure and the Chord onset is replaced with 1.0, then the Notes</span>
<span class="sd">   are shifted to 1.0. If the Measure is then passed in the content</span>
<span class="sd">    of a Staff, the Measure and all its content might be shifted again.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">floor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">amads.core.pitch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pitch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">amads.core.time_map</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeMap</span>


<div class="viewcode-block" id="Event">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Event">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Event</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A superclass for Note, Rest, EventGroup, and just about</span>
<span class="sd">    anything that takes place in time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration of the event in quarters or seconds.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[Event]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        _onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration of the event in quarters or seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;_onset&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">],</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize an Event instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span> <span class="o">=</span> <span class="n">onset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="Event.set">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Event.set">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a property on this Event. Every event can be extended</span>
<span class="sd">        with additional properties.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        property : str</span>
<span class="sd">            The name of the property to set.</span>
<span class="sd">        value : Any</span>
<span class="sd">            The value to assign to the property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>



<div class="viewcode-block" id="Event.get">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Event.get">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the value of a property from this Event.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        property : str</span>
<span class="sd">            The name of the property to get.</span>
<span class="sd">        default : Any, optional</span>
<span class="sd">            The default value to return if the property is not found.</span>
<span class="sd">            (Defaults to None)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any</span>
<span class="sd">            The value of the specified property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>



<div class="viewcode-block" id="Event.has">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Event.has">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the Event has a specific property.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        property : str</span>
<span class="sd">            The name of the property to check.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the property exists, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">property</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></div>



<div class="viewcode-block" id="Event.copy">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Event.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Event&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a deep copy of the Event instance except for the parent,</span>
<span class="sd">        which may be provided as an argument. See also copyempty to copy</span>
<span class="sd">        an EventGroup without the content.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Event</span>
<span class="sd">            A deep copy (except for parent) of the Event instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># remove link to parent to break link going up the tree</span>
        <span class="c1"># preventing deep copy from copying the entire tree</span>
        <span class="n">original_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># deep copy of this event down to leaf nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">original_parent</span>  <span class="c1"># restore link to parent</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span></div>



    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">onset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the onset (start) time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span>


    <span class="nd">@onset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">onset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the onset (start) time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        onset : float</span>
<span class="sd">            The new onset (start) time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span> <span class="o">=</span> <span class="n">onset</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">units_are_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the times are in seconds.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the event&#39;s times in seconds and there is a parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">units_are_seconds</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="kc">False</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">units_are_quarters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the times are in quarters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the event&#39;s times in quarters and there is a parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">units_are_quarters</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="kc">False</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_map</span><span class="p">:</span> <span class="n">TimeMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the event&#39;s duration and onset to seconds using the</span>
<span class="sd">        provided TimeMap.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_map : TimeMap</span>
<span class="sd">            The TimeMap object used for conversion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">onset_time</span> <span class="o">=</span> <span class="n">time_map</span><span class="o">.</span><span class="n">beat_to_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="p">)</span>
        <span class="n">offset_time</span> <span class="o">=</span> <span class="n">time_map</span><span class="o">.</span><span class="n">time_to_beat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">offset_time</span> <span class="o">-</span> <span class="n">onset_time</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_quarters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_map</span><span class="p">:</span> <span class="n">TimeMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the event&#39;s duration and onset to quarters using the</span>
<span class="sd">        provided TimeMap.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_map : TimeMap</span>
<span class="sd">            The TimeMap object used for conversion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">onset_quarters</span> <span class="o">=</span> <span class="n">time_map</span><span class="o">.</span><span class="n">time_to_beat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="p">)</span>
        <span class="n">offset_quarters</span> <span class="o">=</span> <span class="n">time_map</span><span class="o">.</span><span class="n">time_to_beat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset_quarters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">offset_quarters</span> <span class="o">-</span> <span class="n">onset_quarters</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the global offset (stop) time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The global offset (stop) time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>


    <span class="nd">@offset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the global offset (stop) time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        offset : float</span>
<span class="sd">            The new global offset (stop) time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">onset</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">part</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Part&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the Part containing this event</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[Part]</span>
<span class="sd">            The Part containing this event or None if not found.&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Part</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">return</span> <span class="n">p</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Score&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the Score containing this event</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[Score]</span>
<span class="sd">            The Score containing this event or None if not found.&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Score</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">return</span> <span class="n">p</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">staff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Staff&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the Staff containing this event</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[Staff]</span>
<span class="sd">            The Staff containing this event or None if not found.&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Staff</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">return</span> <span class="n">p</span></div>




<div class="viewcode-block" id="Rest">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Rest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Rest</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rest represents a musical rest. It is normally an element of</span>
<span class="sd">    a Measure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time. An initial value of None might</span>
<span class="sd">            be assigned when the Note is inserted into an EventGroup.</span>
<span class="sd">            (Defaults to None)</span>
<span class="sd">        duration : float, optional</span>
<span class="sd">            The duration of the rest in quarters or seconds. (Defaults to 1)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time. None represents an unspecified onset.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration of the rest in quarters or seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>


<div class="viewcode-block" id="Rest.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Rest.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Rest&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Rest information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Rest</span>
<span class="sd">            The Rest instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Rest at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
              <span class="sa">f</span><span class="s2">&quot;duration </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>




<div class="viewcode-block" id="Note">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Note">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Note</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Note represents a musical note. It is normally an element of</span>
<span class="sd">    a Measure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time. An initial value of None might</span>
<span class="sd">            be assigned when the Note is inserted into an EventGroup.</span>
<span class="sd">            (Defaults to None)</span>
<span class="sd">        duration : float, optional</span>
<span class="sd">            The duration of the note in quarters or seconds. (Defaults to 1)</span>
<span class="sd">        pitch : Union[Pitch, int], optional</span>
<span class="sd">            A Pitch object or an integer MIDI key number that will be</span>
<span class="sd">            converted to a Pitch object. (Defaults to C4)</span>
<span class="sd">        dynamic : Optional[Union[int, str]], optional</span>
<span class="sd">            Dynamic level (MIDI velocity) or string. (Defaults to None)</span>
<span class="sd">        lyric : Optional[str], optional</span>
<span class="sd">            Lyric text. (Defaults to None)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : Optional[float]</span>
<span class="sd">            The onset (start) time. None represents an unspecified onset.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration of the note in quarters or seconds. See the</span>
<span class="sd">            property tied_duration for the duration of an entire group</span>
<span class="sd">            if the note is the first of a tied group of notes.</span>
<span class="sd">        pitch : Pitch</span>
<span class="sd">            The pitch of the note.</span>
<span class="sd">        dynamic : Optional[Union[int, str]]</span>
<span class="sd">            Dynamic level (MIDI velocity) or string.</span>
<span class="sd">        lyric : Optional[str]</span>
<span class="sd">            Lyric text.</span>
<span class="sd">        tie : Optional[Note]</span>
<span class="sd">            The note that this note is tied to, if any.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="s2">&quot;lyric&quot;</span><span class="p">,</span> <span class="s2">&quot;tie&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">pitch</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Pitch&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="n">dynamic</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">lyric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a Note instance.</span>
<span class="sd">        pitch is normally a Pitch, but can be an integer MIDI key number</span>
<span class="sd">        that will be converted to a Pitch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">Pitch</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>
        <span class="k">elif</span> <span class="n">pitch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">Pitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">Pitch</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="n">dynamic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lyric</span> <span class="o">=</span> <span class="n">lyric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tie</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Note&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a deep copy of the Note instance. The pitch is</span>
<span class="sd">        shallow copied to avoid copying the entire Pitch object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        memo : bool, optional</span>
<span class="sd">            A dictionary to keep track of already copied objects.</span>
<span class="sd">            (Defaults to None)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Note</span>
<span class="sd">            A deep copy of the Note instance with a shallow copy of the pitch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a deep copy of the Note instance. The pitch is</span>
<span class="sd">        shallow copied to avoid copying the entire Pitch object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        memo : dict</span>
<span class="sd">            A dictionary to keep track of already copied objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Note</span>
<span class="sd">            A deep copy of the Note instance with a shallow copy of the pitch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="c1"># Iterate up the superclass chain and copy __slots__ at each level</span>
        <span class="c1"># If there is a __dict__, it will be in a __slots__ and will be deep</span>
        <span class="c1"># copied, so all attributes in __dict__ will be copied. If there is</span>
        <span class="c1"># multiple inheritance with duplicated slots, this will copy the</span>
        <span class="c1"># duplicated slot two (or more) times, but it should get the right</span>
        <span class="c1"># result.</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;__slots__&#39;</span><span class="p">):</span>
                <span class="n">slots</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="vm">__slots__</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="n">slots</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">slot</span> <span class="o">==</span> <span class="s2">&quot;pitch&quot;</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span>
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">),</span> <span class="n">memo</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tied_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the duration of the note in quarters or seconds.</span>
<span class="sd">        If the note is the first note of a group of tied notes,</span>
<span class="sd">        return the duration of the entire group.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The duration of the note in quarters or seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tie</span><span class="o">.</span><span class="n">tied_duration</span>  <span class="c1"># recursively sum all tied durations</span>
        <span class="k">return</span> <span class="n">duration</span>


<div class="viewcode-block" id="Note.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Note.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tied</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Note&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the note with its pitch name, onset, duration, and optional</span>
<span class="sd">        tie, dynamic, and lyric information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Note</span>
<span class="sd">            The Note instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tie_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tie_info</span> <span class="o">=</span> <span class="s2">&quot; tied&quot;</span>
        <span class="n">dynamic_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dynamic_info</span> <span class="o">=</span> <span class="s2">&quot; dyn &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span><span class="p">)</span>
        <span class="n">lyric_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lyric</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lyric_info</span> <span class="o">=</span> <span class="s2">&quot; lyric &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lyric</span>
        <span class="n">tie_prefix</span> <span class="o">=</span> <span class="s2">&quot;  tied to &quot;</span> <span class="k">if</span> <span class="n">tied</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">onset</span> <span class="o">=</span> <span class="s2">&quot;NO ONSET&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">onset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="s2">&quot;NO DURATION&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tie_prefix</span><span class="si">}</span><span class="s2">Note at </span><span class="si">{</span><span class="n">onset</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
              <span class="sa">f</span><span class="s2">&quot;duration </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> pitch &quot;</span><span class="p">,</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">name_with_octave</span><span class="p">,</span> <span class="n">tie_info</span><span class="p">,</span> <span class="n">dynamic_info</span><span class="p">,</span> <span class="n">lyric_info</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tie</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tie</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tied</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>



    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the name of the pitch, e.g. A, B, C, D, E, F, G</span>
<span class="sd">        corresponding to letter names without accidentals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">step</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the string representation of the pitch name,</span>
<span class="sd">        including accidentals, e.g. A# or Bb.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">name</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name_with_octave</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the string representation of the pitch name</span>
<span class="sd">        with octave, e.g. A4 or Bb3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">name_with_octave</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pitch_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the pitch class of the note, e.g. 0, 1, 2, ..., 11.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">pitch_class</span>


    <span class="nd">@pitch_class</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pitch_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pc</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the pitch class of the note. Keep the same octave, but</span>
<span class="sd">        not necessarily the same register.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pc : int</span>
<span class="sd">            The new pitch class value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">Pitch</span><span class="p">(</span><span class="n">pc</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">octave</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">octave</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the octave number of the note, based on key_num.</span>
<span class="sd">        E.g. C4 is enharmonic to B#3 and represent the same (more or less)</span>
<span class="sd">        pitch, but BOTH have an octave of 4. On the other hand name()</span>
<span class="sd">        will return &quot;C4&quot; and &quot;B#3&quot;, respectively.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The octave number of the note.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">octave</span>


    <span class="nd">@octave</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">octave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">oct</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the octave number of the note.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oct : int</span>
<span class="sd">            The new octave number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">Pitch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_num</span> <span class="o">+</span> <span class="p">(</span><span class="nb">oct</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">octave</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">key_num</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the MIDI key number of the note, e.g. C4 = 60.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The MIDI key number of the note.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">key_num</span>


<div class="viewcode-block" id="Note.enharmonic">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Note.enharmonic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enharmonic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pitch&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a Pitch where alt is zero or has the opposite sign and</span>
<span class="sd">        where alt is minimized. E.g. enharmonic(C-double-flat) is A-sharp</span>
<span class="sd">        (not B-flat). If alt is zero, return a Pitch with alt of +1 or -1</span>
<span class="sd">        if possible. Otherwise, return a Pitch with alt of -2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pitch</span>
<span class="sd">            A Pitch object representing the enharmonic equivalent of the note.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">enharmonic</span><span class="p">()</span></div>



<div class="viewcode-block" id="Note.upper_enharmonic">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Note.upper_enharmonic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">upper_enharmonic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pitch&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a valid Pitch with alt decreased by 1 or 2, e.g. C#-&gt;Db,</span>
<span class="sd">        C##-&gt;D, C###-&gt;D#.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pitch</span>
<span class="sd">            A Pitch object representing the upper enharmonic</span>
<span class="sd">            equivalent of the note.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">upper_enharmonic</span><span class="p">()</span></div>



<div class="viewcode-block" id="Note.lower_enharmonic">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Note.lower_enharmonic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">lower_enharmonic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pitch&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a valid Pitch with alt increased by 1 or 2, e.g. Db-&gt;C#,</span>
<span class="sd">        D-&gt;C##, D#-&gt;C###.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pitch</span>
<span class="sd">            A Pitch object representing the lower enharmonic</span>
<span class="sd">            equivalent of the note.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">lower_enharmonic</span><span class="p">()</span></div>



<div class="viewcode-block" id="Note.simplest_enharmonic">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Note.simplest_enharmonic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">simplest_enharmonic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">sharp_or_flat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pitch&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a valid Pitch with the simplest enharmonic representation.</span>
<span class="sd">        (see Pitch.simplest_enharmonic)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sharp_or_flat: str</span>
<span class="sd">            This is only relevant if the pitch needs an alteration, otherwise</span>
<span class="sd">            it is unused. The value can be &quot;sharp&quot; (use sharps), &quot;flat&quot; (use</span>
<span class="sd">            flats), and otherwise use the same enharmonic choice as the Pitch</span>
<span class="sd">            constructor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pitch</span>
<span class="sd">            A Pitch object representing the enharmonic equivalent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="o">.</span><span class="n">simplest_enharmonic</span><span class="p">(</span><span class="n">sharp_or_flat</span><span class="p">)</span></div>
</div>




<div class="viewcode-block" id="TimeSignature">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.TimeSignature">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeSignature</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TimeSignature is a zero-duration Event with timesig info.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. (Defaults to None)</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time. An initial value of None might</span>
<span class="sd">            be assigned when the TimeSignature is inserted into an EventGroup.</span>
<span class="sd">            (Defaults to None)</span>
<span class="sd">        upper : float, optional</span>
<span class="sd">            The &quot;numerator&quot; of the key signature: subdivisions units per</span>
<span class="sd">            measure, a number, which may be a fraction. (Defaults to 4)</span>
<span class="sd">        lower : int, optional</span>
<span class="sd">            The &quot;denominator&quot; of the key signature: a whole number power</span>
<span class="sd">            of 2, e.g. 1, 2, 4, 8, 16, 32, 64. (Defaults to 4) representing</span>
<span class="sd">            the symbol for one subdivision, e.g. 4 implies quarter note.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            Always zero for this subclass.</span>
<span class="sd">        upper : float</span>
<span class="sd">            The &quot;numerator&quot; of the key signature: subdivisions per measure.</span>
<span class="sd">        lower : int</span>
<span class="sd">            The &quot;denominator&quot; of the key signature: a whole number power of 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">onset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="n">lower</span>


<div class="viewcode-block" id="TimeSignature.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.TimeSignature.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TimeSignature&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the TimeSignature information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TimeSignature</span>
<span class="sd">            The TimeSignature instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TimeSignature at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">,</span>
              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>




<div class="viewcode-block" id="KeySignature">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.KeySignature">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KeySignature</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;KeySignature is a zero-duration Event with keysig info.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. (Defaults to None)</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time. An initial value of None might</span>
<span class="sd">            be assigned when the KeySignature is inserted into an EventGroup.</span>
<span class="sd">            (Defaults to None)</span>
<span class="sd">        keysig : int, optional</span>
<span class="sd">            An integer representing the number of sharps (if positive)</span>
<span class="sd">            and flats (if negative), e.g. -3 for Eb major or C minor.</span>
<span class="sd">            (Defaults to 0)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            Always zero for this subclass.</span>
<span class="sd">        keysig : int</span>
<span class="sd">            An integer representing the number of sharps and flats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;keysig&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">keysig</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="o">=</span><span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keysig</span> <span class="o">=</span> <span class="n">keysig</span>


<div class="viewcode-block" id="KeySignature.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.KeySignature.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;KeySignature&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the KeySignature information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        KeySignature</span>
<span class="sd">            The KeySignature instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;KeySignature at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
              <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysig</span><span class="p">),</span> <span class="s2">&quot; sharps&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keysig</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot; flats&quot;</span><span class="p">,</span>
              <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>





<div class="viewcode-block" id="EventGroup">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EventGroup</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An EventGroup is a collection of Event objects. This is an abstract</span>
<span class="sd">    class. Use one of the subclasses: Score, Part, Staff, Measure or Chord.</span>

<span class="sd">    Normally, you create any EventGroup (Chord, Measure, Staff, Part, Score)</span>
<span class="sd">    with no content, then add content, either in bulk by simply setting the</span>
<span class="sd">    content attribute to a list where list elements are Events whose parent</span>
<span class="sd">    attributes have been set to the group, or one event at a time, by calling</span>
<span class="sd">    the group&#39;s insert method. (This will change the event parent from None</span>
<span class="sd">    to the group.) In this style, it is recommended to specify all onsets</span>
<span class="sd">    and durations explicitly, including the onset of the group itself.</span>

<span class="sd">    Alternatively, you can provide content when the group is constructed.</span>
<span class="sd">    Chord, Measure, Staff, Part, and Score all have *args parameters so that</span>
<span class="sd">    you can write something like</span>
<span class="sd">        Score(Part(Staff(Measure(Note(...), Note(...)),</span>
<span class="sd">                         Measure(Note(...), Note(...)))))</span>
<span class="sd">    In this case, it is recommended that you leave the onsets of content</span>
<span class="sd">    and chord unknown (None, the default). Then, as each event or group</span>
<span class="sd">    becomes content for a parent, the onsets will be set automatically,</span>
<span class="sd">    organizing events sequentially (in Measures and Staves) or</span>
<span class="sd">    concurrently (in Chords, Parts, Scores).</span>

<span class="sd">    The use of unknown (None) onsets is offered as a convenience for</span>
<span class="sd">    simple cases. The main risk is that onsets are considered to be</span>
<span class="sd">    relative to the group onset if the group onset is not known. E.g.</span>
<span class="sd">    if onsets are specified within the content of an EventGroup (Chord,</span>
<span class="sd">    Measure, Staff, Part, Score) but the group onset is unknown (None),</span>
<span class="sd">    and *then* you assign (or a parent assigns) an onset value to the</span>
<span class="sd">    group, the content onsets (even &quot;known&quot; ones) will all be shifted</span>
<span class="sd">    by the assigned onset. This happens *only* when changing an onset</span>
<span class="sd">    from None to a number. Subsequent changes to the group onset will</span>
<span class="sd">    not adjust the content onsets, which are considered absolute times</span>
<span class="sd">    once the group onset is known.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : Optional[list]</span>
<span class="sd">            A list of Event objects to be added to the group. The parent</span>
<span class="sd">            of each Event is set to this EventGroup, and it is an error</span>
<span class="sd">            if any Event already has a parent.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : Optional[float]</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">],</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                 <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Event</span><span class="p">]],</span> <span class="n">pack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="o">=</span><span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Event already has a parent&quot;</span><span class="p">)</span>
                <span class="n">elem</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span> <span class="k">if</span> <span class="n">content</span> <span class="k">else</span> <span class="p">[]</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">onset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span>


    <span class="nd">@onset</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">onset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;When an unspecified onset time is set (normally because this will</span>
<span class="sd">        become the content of a Sequence or Concurrence such as a Staff, Part</span>
<span class="sd">        or Score, the content is assumed to have offsets that reflect deltas</span>
<span class="sd">        from the beginning of this EventGroup. Setting onset to a non-zero</span>
<span class="sd">        value will treat the content onsets as deltas and shift them by onset</span>
<span class="sd">        so that the resulting content has correct absolute onset times.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># shift content</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                <span class="n">elem</span><span class="o">.</span><span class="n">_onset</span> <span class="o">+=</span> <span class="n">onset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span> <span class="o">=</span> <span class="n">onset</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_map</span><span class="p">:</span> <span class="n">TimeMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the event&#39;s duration and onset to seconds using the</span>
<span class="sd">        provided TimeMap. Convert content as well.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_map : TimeMap</span>
<span class="sd">            The TimeMap object used for conversion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="o">.</span><span class="n">_convert_to_seconds</span><span class="p">(</span><span class="n">time_map</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">_convert_to_seconds</span><span class="p">(</span><span class="n">time_map</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_quarters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_map</span><span class="p">:</span> <span class="n">TimeMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the event&#39;s duration and onset to quarters using the</span>
<span class="sd">        provided TimeMap. Convert content as well.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time_map : TimeMap</span>
<span class="sd">            The TimeMap object used for conversion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">onset_quarters</span> <span class="o">=</span> <span class="n">time_map</span><span class="o">.</span><span class="n">time_to_beat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="p">)</span>
        <span class="n">offset_quarters</span> <span class="o">=</span> <span class="n">time_map</span><span class="o">.</span><span class="n">time_to_beat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset_quarters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">offset_quarters</span> <span class="o">-</span> <span class="n">onset_quarters</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">_convert_to_quarters</span><span class="p">(</span><span class="n">time_map</span><span class="p">)</span>


<div class="viewcode-block" id="EventGroup.emptycopy">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.emptycopy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">emptycopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a deep copy of the EventGroup except for the parent and</span>
<span class="sd">        content. The parent may be provided as an argument. This is</span>
<span class="sd">        useful for copying an EventGroup without copying its content.</span>
<span class="sd">        See also copy() to copy an EventGroup with its content.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The new parent to insert the copied Event into.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            A deep copy of the EventGroup instance with the new parent</span>
<span class="sd">            (if any) and no content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># rather than customize __deepcopy__, we &quot;hide&quot; the content to avoid</span>
        <span class="c1"># copying it. Then we restore it after copying and fix parent.</span>
        <span class="n">original_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">original_content</span>
        <span class="n">c</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># change None to (valid) empty content</span>
        <span class="k">return</span> <span class="n">c</span></div>



<div class="viewcode-block" id="EventGroup.expand_chords">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.expand_chords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">expand_chords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="s2">&quot;EventGroup&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace chords with the multiple notes they contain.</span>
<span class="sd">        Returns a deep copy with no parent unless parent is provided.</span>
<span class="sd">        Normally, you will call score.expand_chords() which returns a deep</span>
<span class="sd">        copy of Score with notes moved from each chord to the copy of the</span>
<span class="sd">        chord&#39;s parent (a Measure or a Part). The parent parameter is </span>
<span class="sd">        primarily for internal use when expand_chords is called recursively</span>
<span class="sd">        on score content.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : EventGroup, optional</span>
<span class="sd">            The new parent to insert the copied EventGroup into. (Defaults to None)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            A deep copy of the EventGroup instance with all</span>
<span class="sd">            Chord instances expanded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptycopy</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Chord</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>  <span class="c1"># expand chord</span>
                    <span class="n">note</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">expand_chords</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># recursion for deep copy/expand</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># deep copy non-EventGroup</span>
        <span class="k">return</span> <span class="n">group</span></div>



<div class="viewcode-block" id="EventGroup.find_all">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.find_all">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Event</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Event</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all instances of a specific type within the EventGroup.</span>
<span class="sd">        Assumes that objects of type `elem_type` are not nested within</span>
<span class="sd">        other objects of the same type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elem_type : Type[Event]</span>
<span class="sd">            The type of event to search for.</span>

<span class="sd">        Yields</span>
<span class="sd">        -------</span>
<span class="sd">        Event</span>
<span class="sd">            Instances of the specified type found within the EventGroup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Algorithm: depth-first enumeration of EventGroup content.</span>
        <span class="c1"># If elem_types are nested, only the top-level elem_type is</span>
        <span class="c1"># returned since it is found first, and the content is not</span>
        <span class="c1"># searched. This makes it efficient, e.g., to search for</span>
        <span class="c1"># Parts in a Score without enumerating all Notes within.</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">elem</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">elem</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">elem_type</span><span class="p">)</span></div>



<div class="viewcode-block" id="EventGroup.has_instanceof">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.has_instanceof">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_instanceof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">the_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Event</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if EventGroup (e.g. Score, Part, Staff, Measure) contains any</span>
<span class="sd">        instances of the_class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        the_class : Type[Event]</span>
<span class="sd">            The class type to check for.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True iff the EventGroup contains an instance of the_class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">the_class</span><span class="p">)</span>
        <span class="c1"># if there are no instances (of the_class), next will return &quot;empty&quot;:</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="s2">&quot;empty&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;empty&quot;</span></div>



<div class="viewcode-block" id="EventGroup.has_rests">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.has_rests">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_rests</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if EventGroup (e.g. Score, Part, Staff, Measure) has any</span>
<span class="sd">        Rest objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True iff the EventGroup contains any Rest objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_instanceof</span><span class="p">(</span><span class="n">Rest</span><span class="p">)</span></div>



<div class="viewcode-block" id="EventGroup.has_chords">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.has_chords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_chords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if EventGroup (e.g. Score, Part, Staff, Measure) has any</span>
<span class="sd">        Chord objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True iff the EventGroup contains any Chord objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_instanceof</span><span class="p">(</span><span class="n">Chord</span><span class="p">)</span></div>



<div class="viewcode-block" id="EventGroup.has_ties">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.has_ties">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_ties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if EventGroup (e.g. Score, Part, Staff, Measure) has any</span>
<span class="sd">        tied notes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True iff the EventGroup contains any tied notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">Note</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">tie</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="EventGroup.has_measures">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.has_measures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if EventGroup (e.g. Score, Part, Staff) has any measures.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True iff the EventGroup contains any Measure objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_instanceof</span><span class="p">(</span><span class="n">Measure</span><span class="p">)</span></div>



<div class="viewcode-block" id="EventGroup.inherit_duration">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.inherit_duration">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inherit_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the duration of this EventGroup according to the</span>
<span class="sd">        maximum offset (end) time of its children. If the EventGroup</span>
<span class="sd">        is empty, the duration is set to 0. This method modifies the</span>
<span class="sd">        EventGroup instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            The EventGroup instance (self) with updated duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">onset</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onset</span>
        <span class="n">max_offset</span> <span class="o">=</span> <span class="n">onset</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">max_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_offset</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">max_offset</span> <span class="o">-</span> <span class="n">onset</span>

        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="EventGroup.insert">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.insert">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert an event without any changes to event.onset or</span>
<span class="sd">        self.duration. If the event is out of order, insert it just before</span>
<span class="sd">        the first element with a greater onset. The method modifies this</span>
<span class="sd">        object (self).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : Event</span>
<span class="sd">            The event to be inserted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            The EventGroup instance (self) with the event inserted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">assert</span> <span class="n">event</span><span class="o">.</span><span class="n">onset</span> <span class="o">!=</span> <span class="kc">None</span>  <span class="c1"># must be a number</span>
        <span class="n">atend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">atend</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">onset</span> <span class="o">&lt;</span> <span class="n">atend</span><span class="o">.</span><span class="n">onset</span><span class="p">:</span>
            <span class="c1"># search in reverse from end</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">onset</span> <span class="o">&gt;</span> <span class="n">event</span><span class="o">.</span><span class="n">onset</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="c1"># now i is either -1 or content[i] &lt;= event.onset, so</span>
            <span class="c1"># insert event at content[i+1]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># simply append at the end of content:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="EventGroup.last">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Event</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the last event in the content list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[Event]</span>
<span class="sd">            The last event in the content list or None if the list is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="EventGroup.list_all">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.list_all">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Event</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Event</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all instances of a specific type within the EventGroup.</span>
<span class="sd">        Assumes that objects of type `elem_type` are not nested within</span>
<span class="sd">        other objects of the same type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elem_type : Type[Event]</span>
<span class="sd">            The type of event to search for.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[Event]</span>
<span class="sd">            A list of all instances of the specified type found</span>
<span class="sd">            within the EventGroup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">elem_type</span><span class="p">))</span></div>



<div class="viewcode-block" id="EventGroup.merge_tied_notes">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.merge_tied_notes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">merge_tied_notes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">ignore</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Note</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new EventGroup with tied note sequences replaced by</span>
<span class="sd">        equivalent notes in each staff. Insert the new EventGroup into parent.</span>
<span class="sd">        Notes identified as being tied to are passed in ignore.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Algorithm: Find all notes, removing tied notes and updating</span>
        <span class="c1"># duration when ties are found. These tied notes are added to</span>
        <span class="c1"># ignore so they can be skipped when they are encountered.</span>

        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptycopy</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Note</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>  <span class="c1"># do not copy tied notes into group;</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">tie</span><span class="p">:</span>
                        <span class="n">ignore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">tie</span><span class="p">)</span>  <span class="c1"># add tied note to ignore</span>
                    <span class="c1"># We will not see this note again, so</span>
                    <span class="c1"># we can also remove it from ignore. Removal is expensive</span>
                    <span class="c1"># but it could be worse for ignore to grow large when there</span>
                    <span class="c1"># are many ties since we have to search it entirely once</span>
                    <span class="c1"># per note. An alternate representation might be a set to</span>
                    <span class="c1"># make searching fast.</span>
                    <span class="n">ignore</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">tie</span><span class="p">:</span>
                        <span class="n">tied_note</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">tie</span>  <span class="c1"># save the tied-to note</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">tie</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># block the copy</span>
                        <span class="n">ignore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tied_note</span><span class="p">)</span>
                        <span class="n">event_copy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># copy note into group</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">tie</span> <span class="o">=</span> <span class="n">tied_note</span>  <span class="c1"># restore original event</span>
                        <span class="c1"># this is subtle: event.tied_duration (a property) will sum</span>
                        <span class="c1"># up durations of all the tied notes. Since event_copy</span>
                        <span class="c1"># is not tied, the sum of durations is stored on that</span>
                        <span class="c1"># one event_copy:</span>
                        <span class="n">event_copy</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">tied_duration</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># put the untied note into group</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">):</span>
                <span class="n">event</span><span class="o">.</span><span class="n">merge_tied_notes</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">ignore</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># simply copy to new parent</span>
        <span class="k">return</span> <span class="n">group</span></div>



<div class="viewcode-block" id="EventGroup.remove">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.remove">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an element from the content list. The method modifies</span>
<span class="sd">        this object (self).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        element : Event</span>
<span class="sd">            The event to be removed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            The EventGroup instance (self) with the element removed.</span>
<span class="sd">            The returned value is not a copy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="EventGroup.remove_rests">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.remove_rests">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_rests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="s2">&quot;EventGroup&quot;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove all Rest objects. Returns a deep copy with no parent,</span>
<span class="sd">        unless parent is provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : EventGroup, optional</span>
<span class="sd">            The new parent to insert the copied Event into. (Defaults to None)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            A deep copy of the EventGroup instance with all Rest objects removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># implementation detail: when called without argument, remove_rests</span>
        <span class="c1"># makes a deep copy of the subtree and returns the copy without a</span>
        <span class="c1"># parent. remove_rests calls itself recursively *with* a parameter</span>
        <span class="c1"># indicating that the subtree copy should be inserted into a</span>
        <span class="c1"># parent which is the new copy at the next level up. Of course,</span>
        <span class="c1"># we check for and ignore Rests so they are never copied.</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptycopy</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Rest</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># skip the Rests while making deep copy</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">remove_rests</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># recursion for deep copy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># deep copy non-EventGroup</span>
        <span class="k">return</span> <span class="n">group</span></div>



<div class="viewcode-block" id="EventGroup.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.EventGroup.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventGroup&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the EventGroup information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            The label for the EventGroup. (Defaults to &quot;EventGroup&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EventGroup</span>
<span class="sd">            The EventGroup instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot; at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
              <span class="sa">f</span><span class="s2">&quot;duration </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>




<div class="viewcode-block" id="Sequence">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Sequence">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sequence</span><span class="p">(</span><span class="n">EventGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sequence represents a temporal sequence of music events.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. (Defaults to None)</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. None means unknown, to be</span>
<span class="sd">            set when Sequence is added to a parent. (Defaults to None)</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">            (If duration is omitted or None, the duration is set so</span>
<span class="sd">            that self.offset ends at the max offset in content, or 0</span>
<span class="sd">            if there is no content.) (Defaults to None)</span>
<span class="sd">        content : Optional[list[Event]], optional</span>
<span class="sd">            A list of Event objects to be added to the group. Content</span>
<span class="sd">            events with onsets of None are set to the offset of the</span>
<span class="sd">            previous event in the sequence. The first event onset is</span>
<span class="sd">            the specified group onset, or zero if onset is None.</span>
<span class="sd">            (Defaults to None)</span>
<span class="sd">        pack: bool</span>
<span class="sd">            If true, Events in content are adjusted to form a sequence</span>
<span class="sd">            where the first event onset is the specified group onset</span>
<span class="sd">            (where None means 0) and the onsets of other events are</span>
<span class="sd">            the offsets of the previous events in the sequence. A</span>
<span class="sd">            pack=True value changes the default behavior by overriding</span>
<span class="sd">            any existing onsets in the content and setting the onset of</span>
<span class="sd">            the Sequence to the minimum onset of content. (Defaults to False)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : Optional[float]</span>
<span class="sd">            The onset (start) time. None represents &quot;unknown&quot; and to</span>
<span class="sd">            be determined when this object is added to a parent.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EventGroup</span><span class="p">],</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">content</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Event</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sequence represents a temporal sequence of music events.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># initialize (super) EventGroup with numbers for onset and duration</span>
        <span class="c1"># but they will be adjusted before we return</span>
        <span class="n">temp_onset</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">onset</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">onset</span>
        <span class="c1"># make a pass through the content. Compute onset values: If pack, onsets</span>
        <span class="c1"># are sequentially set to the previous offset stored in prev_offset. If</span>
        <span class="c1"># not pack, only replace onset when onset == None. Here again, prev_offset</span>
        <span class="c1"># will be the previous offset. We also use the loop to compute the maximum</span>
        <span class="c1"># overall offset (max_offset) in case we need to set self.duration. Note</span>
        <span class="c1"># that max_offset is not necessarily the offset of the last Note due to</span>
        <span class="c1"># possible note overlap.</span>
        <span class="n">prev_offset</span> <span class="o">=</span> <span class="n">temp_onset</span>
        <span class="n">max_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">:</span>  <span class="c1"># compute event onsets</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Event</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">e</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="bp">self</span>
                <span class="k">if</span> <span class="n">pack</span> <span class="ow">or</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">onset</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">prev_offset</span>
                    <span class="n">prev_offset</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">offset</span>  <span class="c1"># depends on e.onset</span>
                <span class="n">max_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_offset</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">duration</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># compute duration from content</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">max_offset</span> <span class="o">-</span> <span class="n">temp_onset</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">temp_onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">pack</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset</span>  <span class="c1"># restore onset to None if it was None. This will</span>
        <span class="c1"># enable the adjustment of content if self.onset is set later.</span>


<div class="viewcode-block" id="Sequence.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Sequence.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Sequence information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            The label for the Sequence. (Defaults to &quot;Sequence&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Sequence</span>
<span class="sd">            The Sequence instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>



    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the offset (end) time of the last element,</span>
<span class="sd">        or the onset (start) time if the Sequence is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">offset</span>


<div class="viewcode-block" id="Sequence.pack">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Sequence.pack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust the content to be sequential, begining with the</span>
<span class="sd">        parameter onset (defaults to 0), and each other object at</span>
<span class="sd">        an onset equal to the offset of the previous element. The</span>
<span class="sd">        duration of self is set to the offset of the last element.</span>
<span class="sd">        This method essentially arranges the content to eliminate</span>
<span class="sd">        gaps. pack() works recursively on elements that are</span>
<span class="sd">        EventGroups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time for this object. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            duration of self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">):</span>
                <span class="n">elem</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
            <span class="n">onset</span> <span class="o">+=</span> <span class="n">elem</span><span class="o">.</span><span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">onset</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span></div>
</div>



<div class="viewcode-block" id="Concurrence">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Concurrence">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Concurrence</span><span class="p">(</span><span class="n">EventGroup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Concurrence represents a temporally simultaneous collection</span>
<span class="sd">    of music events (but if elements have a non-zero onset, a Concurrence</span>
<span class="sd">    can represent events organized over time).  Thus, the main distinction</span>
<span class="sd">    between Concurrence and Sequence is that a Sequence can be constructed</span>
<span class="sd">    with pack=True to force sequential timing of the content. Note that a</span>
<span class="sd">    Sequence can have overlapping or entirely simultaneous Events as well.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. (Defaults to None)</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. None means unknown, to be</span>
<span class="sd">            set when Sequence is added to a parent. (Defaults to None)</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">            (If duration is omitted or None, the duration is set so</span>
<span class="sd">            that self.offset ends at the max offset in content, or 0</span>
<span class="sd">            if there is no content.)</span>
<span class="sd">        content : Optional[list[Event]], optional</span>
<span class="sd">            A list of Event objects to be added to the group. Content</span>
<span class="sd">            events with onsets of None are set to the offset of the</span>
<span class="sd">            concurrence, or zero if onset is None. (Defaults to None)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ---------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : Optional[float]</span>
<span class="sd">            The onset (start) time. None represents &quot;unknown&quot; and to</span>
<span class="sd">            be determined when this object is added to a parent.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;EventGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Event</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;duration defaults 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># initialize (super) EventGroup with numbers for onset and duration</span>
        <span class="c1"># but they will be adjusted before we return</span>
        <span class="n">temp_onset</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">onset</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">onset</span>
        <span class="c1"># make a pass through the content. Compute onset values: replace onset</span>
        <span class="c1"># when onset == None. We also use the loop to compute the maximum</span>
        <span class="c1"># overall offset (max_offset) in case we need to set self.duration. Note</span>
        <span class="c1"># that max_offset is not necessarily the offset of the last Note due to</span>
        <span class="c1"># possible note overlap.</span>
        <span class="n">max_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">duration</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">content</span><span class="p">:</span>  <span class="c1"># compute event onsets</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Event</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">e</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">onset</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">temp_onset</span>
                <span class="n">max_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_offset</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">duration</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># compute duration from content</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">max_offset</span> <span class="o">-</span> <span class="n">temp_onset</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
 

<div class="viewcode-block" id="Concurrence.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Concurrence.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concurrence&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Concurrence&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Concurrence information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            The label for the Concurrence. (Defaults to &quot;Concurrence&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Concurrence</span>
<span class="sd">            The Concurrence instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>



<div class="viewcode-block" id="Concurrence.pack">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Concurrence.pack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust the content to onsets starting with the onset parameter</span>
<span class="sd">        (defaults to 0). The duration of self is set to the maximum offset</span>
<span class="sd">        of the content. This method essentially arranges the content to</span>
<span class="sd">        eliminate gaps. pack() works recursively on elements that are</span>
<span class="sd">        EventGroups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        onset : float, optional</span>
<span class="sd">            The onset (start) time for this object. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            duration of self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">onset</span> <span class="o">=</span> <span class="n">onset</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">EventGroup</span><span class="p">):</span>
                <span class="n">elem</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">onset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span></div>
</div>



<div class="viewcode-block" id="Chord">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Chord">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Chord</span><span class="p">(</span><span class="n">Concurrence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Chord is a collection of Notes, normally with onsets equal</span>
<span class="sd">    to that of the chord and the same durations but distinct key_nums,</span>
<span class="sd">    but none of this is enforced.  The order of notes is arbitrary.</span>
<span class="sd">    Normally, a Chord is a member of a Measure. There is no requirement</span>
<span class="sd">    that simultaneous or overlapping notes be grouped into Chords,</span>
<span class="sd">    so the Chord class is merely an optional element of music structure</span>
<span class="sd">    representation.</span>

<span class="sd">    See EventGroup documentation on construction styles.</span>

<span class="sd">    Representation note: An alternative representation would be to</span>
<span class="sd">    subclass Note and allow a list of pitches, which has the advantage</span>
<span class="sd">    of enforcing the shared onsets and durations. However, there can be</span>
<span class="sd">    ties connected differently to each note within the Chord, thus we</span>
<span class="sd">    use a Concurrence with Note objects as elements. Each Note.tie can</span>
<span class="sd">    be None (no tie) or tie to a Note in another Chord or Measure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        *args : Event</span>
<span class="sd">            The Event objects to be added to the group. Content</span>
<span class="sd">            events with onsets of None are set to the offset of the</span>
<span class="sd">            chord, or zero if onset is None. (Defaults to None)</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. None means unknown, to be</span>
<span class="sd">            set when Sequence is added to a parent.  Must be passed</span>
<span class="sd">            as a keyword parameter due to *args. (Defaults to None)</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds. (Defaults to None)</span>
<span class="sd">            (If duration is omitted or None, the duration is set so</span>
<span class="sd">            that self.offset ends at the max offset of args, or 0</span>
<span class="sd">            if there is no content.) Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        content : Optional[list[Event]], optional</span>
<span class="sd">            A list of Event objects to be added to the group. Content</span>
<span class="sd">            events with onsets of None are set to the offset of the</span>
<span class="sd">            chord, or zero if onset is None.  Must be passed as a</span>
<span class="sd">            keyword parameter due to *args. (Defaults to None)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : Optional[float]</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span>
                 <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EventGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chord typically represents a set of Note events.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>


<div class="viewcode-block" id="Chord.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Chord.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Chord&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Chord information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Chord</span>
<span class="sd">            The Chord instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="s2">&quot;Chord&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Chord.is_measured">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Chord.is_measured">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Chord conforms to strict hierarchy of Chord-Note</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># Chord can (in theory) contain many object types, so we can</span>
            <span class="c1"># only rule out things that are outside of the strict hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">Staff</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">Rest</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>
</div>




<div class="viewcode-block" id="Measure">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Measure">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Measure</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Measure models a musical measure (bar) and can contain many object</span>
<span class="sd">    types including Note, Rest, Chord, KeySignature, Timesignature and (in</span>
<span class="sd">    theory) custom Events. Measures are elements of a Staff.</span>

<span class="sd">    See EventGroup documentation on construction styles.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        *args:  Event</span>
<span class="sd">            A variable number of Event objects to be added to the group.</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. None means unknown, to be set when</span>
<span class="sd">            Sequence is added to a parent. Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds. Must be passed as a</span>
<span class="sd">            keyword parameter due to *args. (Defaults to 4)</span>
<span class="sd">        number : Optional[str], optional</span>
<span class="sd">            A string representing the measure number. Must be passed as</span>
<span class="sd">            a keyword parameter due to *args. (Defaults to None)</span>
<span class="sd">        pack : bool, optional</span>
<span class="sd">            If true, Events in *args are adjusted to form a sequence</span>
<span class="sd">            where the first event onset is the specified group onset</span>
<span class="sd">            (which defaults to 0) and the onset of other events is the</span>
<span class="sd">            offset of the previous event in the sequence. Must be passed</span>
<span class="sd">            as a keyword parameter due to *args. (Defaults to False).</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : Optional[float]</span>
<span class="sd">            The onset (start) time. None represents &quot;unknown&quot; and to</span>
<span class="sd">            be determined when this object is added to a parent.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this Measure.</span>
<span class="sd">        number : Optional[str]</span>
<span class="sd">            A string representing the measure number if any.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EventGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">pack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>


<div class="viewcode-block" id="Measure.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Measure.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Measure&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Measure information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Measure</span>
<span class="sd">            The Measure instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nstr</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="s2">&quot;Measure&quot;</span> <span class="o">+</span> <span class="n">nstr</span><span class="p">)</span></div>



<div class="viewcode-block" id="Measure.is_measured">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Measure.is_measured">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Measure conforms to strict hierarchy of:</span>
<span class="sd">        Measure-(Note or Rest or Chord) and Chord-Note</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the Measure conforms to normal hierarchy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># Measure can (in theory) contain many object types, so we can</span>
            <span class="c1"># only rule out things that are outside of the strict hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">Staff</span><span class="p">,</span> <span class="n">Measure</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">is_measured</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>
</div>




<div class="viewcode-block" id="Score">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Score</span><span class="p">(</span><span class="n">Concurrence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A score is a top-level object representing a musical work.</span>
<span class="sd">    Normally, a Score contains Part objects, all with onsets zero.</span>

<span class="sd">    See EventGroup documentation on construction styles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        *args : Event</span>
<span class="sd">            A variable number of Event objects to be added to the group.</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. If unknown (None), onset will be set</span>
<span class="sd">            when the score is added to a parent, but normally, Scores do</span>
<span class="sd">            not have parents, so the default onset is 0. You can override</span>
<span class="sd">            this using keyword parameter (due to *args).</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">            (If duration is omitted or None, the duration is set so</span>
<span class="sd">            that self.offset ends at the max offset of args, or 0</span>
<span class="sd">            if there is no content.) Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        time_map : TimeMap, optional</span>
<span class="sd">            A map from quarters to seconds (or seconds to quarters).</span>
<span class="sd">            Must be passed as a keyword parameter due to *args.</span>
<span class="sd">            (Defaults to None)</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">        time_map : TimeMap</span>
<span class="sd">            A map from quarters to seconds (or seconds to quarters).</span>
<span class="sd">        _units_are_seconds : bool</span>
<span class="sd">            True if the units are seconds, False if the units are quarters.</span>

<span class="sd">    Additional attributes may be assigned, e.g. &#39;title&#39;, &#39;source_file&#39;,</span>
<span class="sd">    &#39;composer&#39;, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time_map&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">time_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;TimeMap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>  <span class="c1"># score parent is None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_map</span> <span class="o">=</span> <span class="n">time_map</span> <span class="k">if</span> <span class="n">time_map</span> <span class="k">else</span> <span class="n">TimeMap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units_are_seconds</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="Score.from_melody">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.from_melody">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_melody</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                    <span class="n">pitches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Pitch</span><span class="p">]],</span>
                    <span class="n">durations</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">iois</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">onsets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Score&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Score from a melody specified as a list of pitches</span>
<span class="sd">        and optional timing information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pitches : list of int or list of Pitch</span>
<span class="sd">            MIDI note numbers or Pitch objects for each note.</span>
<span class="sd">        durations : float or list of float</span>
<span class="sd">            Durations for each note. If a scalar value, it will be repeated</span>
<span class="sd">            for all notes. Defaults to 1.0 (quarter notes).</span>
<span class="sd">        iois : float or list of float or None, optional Inter-onset</span>
<span class="sd">            intervals between successive notes. If a scalar value,</span>
<span class="sd">            it will be repeated for all notes. If not provided and</span>
<span class="sd">            onsets is None, takes values from the durations argument,</span>
<span class="sd">            assuming that notes are placed sequentially without overlap.</span>
<span class="sd">        onsets : list of float or None, optional</span>
<span class="sd">            Start times. Cannot be used together with iois.</span>
<span class="sd">            If both are None, defaults to using durations as IOIs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Score</span>
<span class="sd">            A new Score object containing the melody in a single part.</span>
<span class="sd">            If pitches is empty, returns a score with an empty part.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Create a simple C major scale with default timing (sequential quarter notes):</span>

<span class="sd">        &gt;&gt;&gt; score = Score.from_melody([60, 62, 64, 65, 67, 69, 71, 72])  # all quarter notes</span>
<span class="sd">        &gt;&gt;&gt; notes = score.content[0].content</span>
<span class="sd">        &gt;&gt;&gt; len(notes)  # number of notes in first part</span>
<span class="sd">        8</span>
<span class="sd">        &gt;&gt;&gt; notes[0].key_num</span>
<span class="sd">        60</span>
<span class="sd">        &gt;&gt;&gt; score.duration  # last note ends at t=8</span>
<span class="sd">        8.0</span>

<span class="sd">        Create three notes with varying durations:</span>

<span class="sd">        &gt;&gt;&gt; score = Score.from_melody(</span>
<span class="sd">        ...     pitches=[60, 62, 64],  # C4, D4, E4</span>
<span class="sd">        ...     durations=[0.5, 1.0, 2.0],</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; score.duration  # last note ends at t=3.5</span>
<span class="sd">        3.5</span>

<span class="sd">        Create three notes with custom IOIs:</span>

<span class="sd">        &gt;&gt;&gt; score = Score.from_melody(</span>
<span class="sd">        ...     pitches=[60, 62, 64],  # C4, D4, E4</span>
<span class="sd">        ...     durations=1.0,  # quarter notes</span>
<span class="sd">        ...     iois=2.0,  # 2 beats between each note onset</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; score.duration  # last note ends at t=5</span>
<span class="sd">        5.0</span>

<span class="sd">        Create three notes with explicit onsets:</span>

<span class="sd">        &gt;&gt;&gt; score = Score.from_melody(</span>
<span class="sd">        ...     pitches=[60, 62, 64],  # C4, D4, E4</span>
<span class="sd">        ...     durations=1.0,  # quarter notes</span>
<span class="sd">        ...     onsets=[0.0, 2.0, 4.0],  # onset times 2 beats apart</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; score.duration  # last note ends at t=5</span>
<span class="sd">        5.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_melody</span><span class="p">(</span><span class="n">pitches</span><span class="o">=</span><span class="p">[],</span> <span class="n">onsets</span><span class="o">=</span><span class="p">[],</span> <span class="n">durations</span><span class="o">=</span><span class="p">[])</span>

        <span class="k">if</span> <span class="n">iois</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">onsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify both iois and onsets&quot;</span><span class="p">)</span>

        <span class="c1"># Convert scalar durations to list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">durations</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span>

        <span class="c1"># If onsets are provided, use them directly</span>
        <span class="k">if</span> <span class="n">onsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">onsets</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;onsets list must have same length as pitches&quot;</span><span class="p">)</span>
            <span class="n">onsets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">onsets</span><span class="p">]</span>

        <span class="c1"># Otherwise convert IOIs to onsets</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># onsets is Nonex</span>
            <span class="n">onsets</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
            <span class="c1"># If no IOIs provided, use durations as default IOIs</span>
            <span class="k">if</span> <span class="n">iois</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">iois</span> <span class="o">=</span> <span class="n">durations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last duration not needed for IOIs</span>
            <span class="c1"># Convert scalar IOIs to list</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iois</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">iois</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">iois</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Validate IOIs length</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iois</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;iois list must have length len(pitches) - 1&quot;</span><span class="p">)</span>

            <span class="c1"># Convert IOIs to onsets</span>
            <span class="n">onsets</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>  <span class="c1"># first note onsets at 0</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">ioi</span> <span class="ow">in</span> <span class="n">iois</span><span class="p">:</span>
                <span class="n">current_time</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ioi</span><span class="p">)</span>
                <span class="n">onsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">onsets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All input lists must have the same length&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_melody</span><span class="p">(</span><span class="n">pitches</span><span class="p">,</span> <span class="n">onsets</span><span class="p">,</span> <span class="n">durations</span><span class="p">)</span></div>



    <span class="c1"># the Score.units_are_quarters is the base case for the recursive</span>
    <span class="c1"># Event.units_are_quarters method.</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">units_are_quarters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if the units are in quarters, False if in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_are_seconds</span>


    <span class="c1"># the Score.units_are_seconds is the base case for the recursive</span>
    <span class="c1"># Event.units_are_seconds method.</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">units_are_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if the units are in seconds, False if in quarters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units_are_seconds</span>


<div class="viewcode-block" id="Score.convert_to_seconds">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.convert_to_seconds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_to_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the score to represent time in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_are_seconds</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_convert_to_seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timemap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units_are_seconds</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># set the flag</span></div>



<div class="viewcode-block" id="Score.convert_to_quarters">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.convert_to_quarters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_to_quarters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the score to represent time in quarters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_are_seconds</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_convert_to_quarters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timemap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units_are_seconds</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># clear the flag</span></div>



<div class="viewcode-block" id="Score.collapse_parts">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.collapse_parts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">collapse_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">staff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">has_ties</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge the notes of selected Parts and Staffs into a flattened</span>
<span class="sd">        score with only one part, retaining only Notes. (Ties are merged.)</span>

<span class="sd">        If you are using this method to extract notes by Staff, you can save</span>
<span class="sd">        some computation by performing a one-time</span>
<span class="sd">            score = score.merge_tied_notes()</span>
<span class="sd">        and providing the parameter has_ties=False. If has_ties is False,</span>
<span class="sd">        it is assumed without checking that part.has_ties() is False,</span>
<span class="sd">        allowing this method to skip calls to part.merge_tied_notes()</span>
<span class="sd">        for each selected part.</span>

<span class="sd">        The flatten() method is similar. It can flatten each Part</span>
<span class="sd">        while retaining (not merging) the Parts, or it can flatten</span>
<span class="sd">        all notes into one Part. Normally, you use collapse_parts</span>
<span class="sd">        to select an individual Staff or Part and flatten it to a</span>
<span class="sd">        single note sequence.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        part : Union[Number, str, list[int], None], optional</span>
<span class="sd">            If part is not None, only notes from the selected part are</span>
<span class="sd">            included.</span>
<span class="sd">            part may be an integer to match a part number, or</span>
<span class="sd">            part may be a string to match a part instrument, or</span>
<span class="sd">            part may be a list with an index, e.g. [3] will select the 4th</span>
<span class="sd">            part (because indexing is zero-based).</span>
<span class="sd">        staff : Union[int, List[int], None], optional</span>
<span class="sd">            If staff is given, only the notes from selected staves are</span>
<span class="sd">            included.</span>
<span class="sd">            staff may be an integer to match a staff number, or</span>
<span class="sd">            staff may be a list with an index, e.g. [1] will select</span>
<span class="sd">            the 2nd staff.</span>
<span class="sd">            If staff is given without a part specification, an exception</span>
<span class="sd">            is raised.</span>
<span class="sd">            If staff is given and this is a flattened score (no staves),</span>
<span class="sd">            an exception is raised.</span>

<span class="sd">        Note: The use of the form [1] for part and staff index notation</span>
<span class="sd">        is not ideal, but we need to distinguish between part numbers</span>
<span class="sd">        (arbitrary labels) and part index. Initially, I used tuples,</span>
<span class="sd">        but they are error prone. E.g. part=(0) means part=0, so you</span>
<span class="sd">        have to write key_num_list(part=((0))). With [n], you write</span>
<span class="sd">        key_num_list(part=[0]) to indicate an index. This is</span>
<span class="sd">        prettier and less prone to error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Algorithm: Since we might be selecting individual Staffs and</span>
        <span class="c1"># Parts, we want to do selection first, then copy to avoid</span>
        <span class="c1"># modifying the source Score (self).</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collect selected Parts/Staffs here</span>
        <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptycopy</span><span class="p">()</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">Part</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">part</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">instrument</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)):</span>
                <span class="c1"># merging tied notes takes place at the Part level because</span>
                <span class="c1"># notes can be tied across Staffs.</span>
                <span class="k">if</span> <span class="n">has_ties</span><span class="p">:</span>
                    <span class="c1"># put parts into score copy to allow onset computation</span>
                    <span class="c1"># later, we will merge notes and remove these parts</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">merge_tied_notes</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">staff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># no staff selection, use whole Part</span>
                    <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># must find Notes in selected Staffs</span>
                    <span class="n">staffs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">Staff</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">staffs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">staff</span> <span class="ow">is</span> <span class="kc">None</span>
                            <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">staff</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                            <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">staff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)):</span>
                            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="c1"># now content is a list of Parts or Staffs to merge</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">part_or_staff</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>  <span class="c1"># works with both Part and Score:</span>
            <span class="n">notes</span> <span class="o">+=</span> <span class="n">part_or_staff</span><span class="o">.</span><span class="n">list_all</span><span class="p">(</span><span class="n">Note</span><span class="p">)</span>
        <span class="n">new_part</span> <span class="o">=</span> <span class="n">Part</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_ties</span><span class="p">:</span>
            <span class="c1"># because we avoided merging ties in parts, notes still belong</span>
            <span class="c1"># to the original score (self), so we need to copy them:</span>
            <span class="n">copies</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># copy all notes to here</span>
            <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
                <span class="c1"># rather than a possibly expensive insert into new_part, we</span>
                <span class="c1"># use sort (below) to construct the content of new_part.</span>
                <span class="n">copies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="n">notes</span> <span class="o">=</span> <span class="n">copies</span>
        <span class="c1"># notes can be modified, so reuse them in the new_part:</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">note</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">new_part</span>
        <span class="n">notes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">onset</span><span class="p">)</span>
        <span class="n">new_part</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">notes</span>
        <span class="c1"># remove all the parts that we merged, leaving only new_part</span>
        <span class="n">score</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_part</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">score</span></div>



<div class="viewcode-block" id="Score.flatten">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.flatten">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deep copy notes in a score to a flattened score consisting of</span>
<span class="sd">        only Parts containing Notes (Ties are merged.)</span>

<span class="sd">        See collapse_parts() to select specific Parts or Staffs and</span>
<span class="sd">        flatten them.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        collapse : bool, optional</span>
<span class="sd">            If collapse is True, multiple parts are collapsed into a single</span>
<span class="sd">            part, and notes are ordered according to onset times. The resulting</span>
<span class="sd">            score contains one or more Parts, each containing only Notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_tied_notes</span><span class="p">()</span>  <span class="c1"># also copies score</span>
        <span class="c1"># it is now safe to modify score because it has been copied</span>
        <span class="k">if</span> <span class="n">collapse</span><span class="p">:</span>  <span class="c1"># similar to Part.flatten() but we have to sort and</span>
            <span class="c1"># do some other extra work to put all notes into score</span>
            <span class="n">new_part</span> <span class="o">=</span> <span class="n">Part</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">onset</span><span class="o">=</span><span class="n">score</span><span class="o">.</span><span class="n">onset</span><span class="p">)</span>
            <span class="n">notes</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">list_all</span><span class="p">(</span><span class="n">Note</span><span class="p">)</span>  <span class="c1"># force iterator into list to sort</span>
            <span class="n">score</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_part</span><span class="p">]</span>  <span class="c1"># remove all other parts and events</span>
            <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
                <span class="n">note</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">new_part</span>
            <span class="c1"># notes with equal onset times are sorted in pitch from high to low</span>
            <span class="n">notes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">onset</span><span class="p">,</span> <span class="o">-</span><span class="n">note</span><span class="o">.</span><span class="n">key_num</span><span class="p">))</span>
            <span class="n">new_part</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">notes</span>  <span class="c1"># content will have only Notes</span>

            <span class="c1"># set the Part duration so it ends at the max offset of all Parts:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">part</span><span class="o">.</span><span class="n">offset</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">Part</span><span class="p">)),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">new_part</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">-</span> <span class="n">score</span><span class="o">.</span><span class="n">onset</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># flatten each part separately</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">score</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">Part</span><span class="p">):</span>
                <span class="n">part</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">score</span></div>



    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_from_melody</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                     <span class="n">pitches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Pitch</span><span class="p">]],</span>
                     <span class="n">onsets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                     <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Score&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to create a Score from preprocessed lists of pitches,</span>
<span class="sd">        onsets, and durations.</span>

<span class="sd">        All inputs must be lists of the same length, with numeric values already</span>
<span class="sd">        converted to float.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pitches</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">onsets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All inputs must be lists of the same length&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">onsets</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All onsets must be floats&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All durations must be floats&quot;</span><span class="p">)</span>

        <span class="c1"># Check for overlapping notes</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">onsets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">current_end</span> <span class="o">=</span> <span class="n">onsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">durations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">next_onset</span> <span class="o">=</span> <span class="n">onsets</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">current_end</span> <span class="o">&gt;</span> <span class="n">next_onset</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Notes overlap: note </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> ends at </span><span class="si">{</span><span class="n">current_end</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> \
                        <span class="sa">f</span><span class="s2">&quot; but note </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> starts at </span><span class="si">{</span><span class="n">next_onset</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">score</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">Part</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>

        <span class="c1"># Create notes and add them to the part</span>
        <span class="k">for</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pitches</span><span class="p">,</span> <span class="n">onsets</span><span class="p">,</span> <span class="n">durations</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">Pitch</span><span class="p">):</span>
                <span class="n">pitch</span> <span class="o">=</span> <span class="n">Pitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
            <span class="n">Note</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">pitch</span><span class="p">)</span>

        <span class="c1"># Set the score duration to the end of the last note</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">onsets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">score</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">onset</span> <span class="o">+</span> <span class="n">duration</span> <span class="k">for</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">onsets</span><span class="p">,</span> <span class="n">durations</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">score</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">score</span>


<div class="viewcode-block" id="Score.is_flat">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.is_flat">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_flat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Score is flat. Conforms to strict hierarchy of:</span>
<span class="sd">        Score-Part-Note with no tied notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># only Parts are expected, but things outside of the hierarchy</span>
            <span class="c1"># are allowed, so we only rule out violations of the hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Staff</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">Note</span><span class="p">,</span> <span class="n">Rest</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">Part</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">part</span><span class="o">.</span><span class="n">is_flat</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="Score.is_flat_and_collapsed">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.is_flat_and_collapsed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_flat_and_collapsed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if score has been flattened into one part&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">part_count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_flat</span><span class="p">()</span></div>



<div class="viewcode-block" id="Score.is_measured">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.is_measured">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Score is measured. Conforms to strict hierarchy of:</span>
<span class="sd">        Score-Part-Staff-Measure-(Note or Rest or Chord) and Chord-Note.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the Score is measured, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># only Parts are expected, but things outside of the hierarchy</span>
            <span class="c1"># are allowed, so we only rule out violations of the hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Staff</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">Note</span><span class="p">,</span> <span class="n">Rest</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">Part</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">part</span><span class="o">.</span><span class="n">is_measured</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="Score.note_containers">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.note_containers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">note_containers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of non-empty note containers. For Measured Scores,</span>
<span class="sd">        these are the Staff objects. For Flat Scores, these are the Part</span>
<span class="sd">        objects. This is mainly useful for extracting note sequences where</span>
<span class="sd">        each staff represents a separate sequence. In a Flat Score,</span>
<span class="sd">        staves are collapsed and each Part (instrument) represents a</span>
<span class="sd">        separate sequence. This implementation also handles a mix of</span>
<span class="sd">        Parts with and without Staffs, returning a list of whichever</span>
<span class="sd">        is the direct parent of a list of Notes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># start with parts, which are common to both measured scores and</span>
        <span class="c1"># flat scores. If the Part has a Staff, the Staffs are the</span>
        <span class="c1"># containers we want. If the Part has a Note, the Part itself is</span>
        <span class="c1"># the container. Other event classes can exist and are ignored.</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">Part</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Staff</span><span class="p">):</span>
                    <span class="n">containers</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">list_all</span><span class="p">(</span><span class="n">Staff</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Note</span><span class="p">):</span>
                    <span class="n">containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="c1"># if part was empty, it is not added to containers</span>
        <span class="k">return</span> <span class="n">containers</span></div>



<div class="viewcode-block" id="Score.part_count">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.part_count">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">part_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many parts are in this score?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_all</span><span class="p">(</span><span class="n">Part</span><span class="p">))</span></div>



<div class="viewcode-block" id="Score.remove_measures">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.remove_measures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Score&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Score with all Measures removed, but preserving</span>
<span class="sd">        Staffs in the hierarchy. Notes are &quot;lifted&quot; from Measures to become</span>
<span class="sd">        direct content of their Staff. The result satisfies neither is_flat()</span>
<span class="sd">        nor is_measured(), but it could be useful in preserving a</span>
<span class="sd">        separation between staves. See also ``collapse_parts()``, which</span>
<span class="sd">        can be used to extract individual staves from a score. The result</span>
<span class="sd">        will have ties merged. (If you want to preserve ties and access</span>
<span class="sd">        the notes in a Staff, consider using find_all(Staff), and then</span>
<span class="sd">        for each staff, find_all(Note), but note that ties can cross</span>
<span class="sd">        between staves.)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Score</span>
<span class="sd">            A new Score instance with all Measures removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emptycopy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">Part</span><span class="p">):</span>
                <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">merge_tied_notes</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
                <span class="n">part</span><span class="o">.</span><span class="n">remove_measures</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">has_ties</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># non-Part objects are simply copied</span>
                <span class="n">part</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">score</span></div>



<div class="viewcode-block" id="Score.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Score&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Score information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Score</span>
<span class="sd">            The Score instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Score at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">onset</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
              <span class="sa">f</span><span class="s2">&quot;duration </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_map</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="Score.get_sorted_notes">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Score.get_sorted_notes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_sorted_notes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of sorted notes with merged ties&quot;&quot;&quot;</span>
        <span class="c1"># score will have one Part, content of which is all Notes:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">collapse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span></div>
</div>




<div class="viewcode-block" id="Part">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Part">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Part</span><span class="p">(</span><span class="n">Concurrence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Part models a staff or staff group such as a grand staff. For that</span>
<span class="sd">    reason, a Part contains one or more Staff objects. It should not contain</span>
<span class="sd">    any other object types. Parts are normally elements of a Score. Note that</span>
<span class="sd">    in a flattened score, a Part is a collection of Notes, not Staffs, and it</span>
<span class="sd">    should be organized more sequentially than concurrently, so the default</span>
<span class="sd">    assignment of onset times may not be appropriate.</span>

<span class="sd">    See EventGroup documentation on construction styles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        *args : Optional[Event], optional</span>
<span class="sd">            A variable number of Event objects to be added to the group.</span>
<span class="sd">        parent : Optional[EventGroup], optional</span>
<span class="sd">            The containing object or None. Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. If unknown (None), it will be set</span>
<span class="sd">            when this Part is added to a parent. Must be passed as a</span>
<span class="sd">            keyword parameter due to *args. (Defaults to None)</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">            (If duration is omitted or None, the duration is set so</span>
<span class="sd">            that self.offset ends at the max offset of args, or 0</span>
<span class="sd">            if there is no content.)  Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        number : Optional[str], optional</span>
<span class="sd">            A string representing the part number. (Defaults to None)</span>
<span class="sd">        instrument : Optional[str], optional</span>
<span class="sd">            A string representing the instrument name. (Defaults to None)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">        number : Union[str, None]</span>
<span class="sd">            A string representing the part number (if any). E.g. &quot;22a&quot;.</span>
<span class="sd">        instrument : Union[str, None]</span>
<span class="sd">            A string representing the instrument name (if any).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;instrument&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span>
                 <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Score</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">instrument</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument</span> <span class="o">=</span> <span class="n">instrument</span>


<div class="viewcode-block" id="Part.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Part.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Part information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Part</span>
<span class="sd">            The Part instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="s2">&quot;Part&quot;</span> <span class="o">+</span> <span class="n">nstr</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="Part.is_measured">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Part.is_measured">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Part is measured. Conforms to strict hierarchy of:</span>
<span class="sd">        Part-Staff-Measure-(Note or Rest or Chord) and Chord-Note.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">staff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># only Staffs are expected, but things outside of the hierarchy</span>
            <span class="c1"># are allowed, so we only rule out violations of the hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">Note</span><span class="p">,</span> <span class="n">Rest</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="n">staff</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">staff</span><span class="o">.</span><span class="n">is_measured</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>



    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_find_tied_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notes</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;find notes tied to notes[i]&quot;&quot;&quot;</span>
        <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  <span class="c1"># start the list</span>
        <span class="k">while</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tie</span> <span class="o">==</span> <span class="s2">&quot;start&quot;</span> <span class="ow">or</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tie</span> <span class="o">==</span> <span class="s2">&quot;continue&quot;</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span>
            <span class="n">key_num</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">key_num</span>  <span class="c1"># allow ties to enharmonics</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># save indices of possible tied notes</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># search for candidates starting at i + 1</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">notes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">onset</span> <span class="o">&lt;</span> <span class="n">offset</span> <span class="o">+</span> <span class="mf">0.0001</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">key_num</span> <span class="o">==</span> <span class="n">key_num</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tie</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span> <span class="ow">or</span> <span class="n">notes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tie</span> <span class="o">==</span> <span class="s2">&quot;continue&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">notes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">onset</span> <span class="o">&gt;</span> <span class="n">offset</span> <span class="o">-</span> <span class="mf">0.0001</span><span class="p">):</span>
                    <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>  <span class="c1"># found one!</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no note can resolve tie&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># do extra work to compare Staffs</span>
                <span class="n">staff</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">staff</span>
                <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">notes</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">staff</span> <span class="o">==</span> <span class="n">staff</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;could not resolve ambiguous tie&quot;</span><span class="p">)</span>
            <span class="c1"># else note that we can tie notes between Staffs when it is not</span>
            <span class="c1">#     ambiguous</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># note that the loop will collect notes until we satisfy</span>
            <span class="c1">#     notes[i].tie == &#39;stop&#39;, so notes[i].tie == &#39;continue&#39;</span>
            <span class="c1">#     cause the loop to find the next tied note.</span>
        <span class="k">return</span> <span class="n">group</span>


<div class="viewcode-block" id="Part.flatten">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Part.flatten">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build a flattened Part where content will consist of notes only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        in_place : bool, optional</span>
<span class="sd">            If in_place=True, assume Part already has no ties and can be</span>
<span class="sd">            modified. Otherwise, return a new Part where deep copies of</span>
<span class="sd">            tied notes are merged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">part</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">in_place</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_tied_notes</span><span class="p">()</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">list_all</span><span class="p">(</span><span class="n">Note</span><span class="p">)</span>  <span class="c1"># need list so we can sort</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">note</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">part</span>
        <span class="n">notes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">onset</span><span class="p">)</span>
        <span class="n">part</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">notes</span>
        <span class="k">return</span> <span class="n">part</span></div>



<div class="viewcode-block" id="Part.is_flat">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Part.is_flat">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_flat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Part is flat (contains only notes without ties).&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># only Notes without ties are expected, but things outside of</span>
            <span class="c1"># the hierarchy are allowed, so we only rule out violations of</span>
            <span class="c1"># the hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">Staff</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">Rest</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="n">Note</span><span class="p">)</span> <span class="ow">and</span> <span class="n">note</span><span class="o">.</span><span class="n">tie</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="Part.remove_measures">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Part.remove_measures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Score&quot;</span><span class="p">],</span>
                        <span class="n">has_ties</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a Part with all Measures removed, but preserving</span>
<span class="sd">        Staffs in the hierarchy. Notes are &quot;lifted&quot; from Measures to</span>
<span class="sd">        become direct content of their Staff. Uses `merge_tied_notes()`</span>
<span class="sd">        to copy this Part unless `has_ties` is False, in which case</span>
<span class="sd">        there must be no tied notes and this Part is modified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        score : Union[Score, None]</span>
<span class="sd">            The Score instance (if any) to which the new Part will be added.</span>
<span class="sd">        has_ties : bool, optional</span>
<span class="sd">            If False, assume this is a copy we are free to modify,</span>
<span class="sd">            there are tied notes, and this Part is already contained</span>
<span class="sd">            by `score`. (Defaults to True: this Part will be copied</span>
<span class="sd">            into `score`.)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Part</span>
<span class="sd">            A Part with all Measures removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_tied_notes</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">if</span> <span class="n">has_ties</span> <span class="k">else</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">staff</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="n">Staff</span><span class="p">):</span>
                <span class="n">staff</span><span class="o">.</span><span class="n">remove_measures</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">part</span></div>
</div>



<div class="viewcode-block" id="Staff">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Staff">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Staff</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Staff models a musical staff line extending through all systems.</span>
<span class="sd">    It can also model one channel of a standard MIDI file track. A Staff</span>
<span class="sd">    normally contains Measure objects and is an element of a Part.</span>

<span class="sd">    See EventGroup documentation on construction styles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        *args : Optional[Event], optional</span>
<span class="sd">            A variable number of Event objects to be added to the group.</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None. (Defaults to None)</span>
<span class="sd">        onset : Optional[float], optional</span>
<span class="sd">            The onset (start) time. If unknown (None), it will be set</span>
<span class="sd">            when this Staff is added to a parent. Must be passed as a</span>
<span class="sd">            keyword parameter due to *args. (Defaults to None)</span>
<span class="sd">        duration : Optional[float], optional</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">            (If duration is omitted or None, the duration is set so</span>
<span class="sd">            that self.offset ends at the max offset of args, or 0</span>
<span class="sd">            if there is no content.) Must be passed as a keyword</span>
<span class="sd">            parameter due to *args. (Defaults to None)</span>
<span class="sd">        number : Optional[int], optional</span>
<span class="sd">            The staff number. Normally, a Staff is given an integer</span>
<span class="sd">            number where 1 is the top staff of the part, 2 is the 2nd,</span>
<span class="sd">            etc. Must be passed as a keyword parameter due to *args.</span>
<span class="sd">            (Defaults to None)</span>
<span class="sd">        pack : bool, optional</span>
<span class="sd">            If true, Events in *args are adjusted to form a sequence</span>
<span class="sd">            where the first event onset is the specified group onset</span>
<span class="sd">            (which defaults to 0) and the onset of other events is</span>
<span class="sd">            the offset of the previous event in the sequence.</span>
<span class="sd">            Must be passed as a keyword parameter due to *args.</span>
<span class="sd">            (Defaults to False).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        parent : Optional[EventGroup]</span>
<span class="sd">            The containing object or None.</span>
<span class="sd">        onset : float</span>
<span class="sd">            The onset (start) time.</span>
<span class="sd">        duration : float</span>
<span class="sd">            The duration in quarters or seconds.</span>
<span class="sd">        content : list[Event]</span>
<span class="sd">            Elements contained within this collection.</span>
<span class="sd">        number : Optional[int]</span>
<span class="sd">            The staff number. Normally a Staff is given an integer number</span>
<span class="sd">            where 1 is the top staff of the part, 2 is the 2nd, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span>
                 <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EventGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">onset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pack</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">onset</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">pack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>


<div class="viewcode-block" id="Staff.show">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Staff.show">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Staff&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Staff information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : int, optional</span>
<span class="sd">            The indentation level for display. (Defaults to 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Staff</span>
<span class="sd">            The Staff instance itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nstr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="s2">&quot;Staff&quot;</span> <span class="o">+</span> <span class="n">nstr</span><span class="p">)</span></div>



<div class="viewcode-block" id="Staff.is_measured">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Staff.is_measured">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if Staff is measured. Conforms to strict hierarchy of:</span>
<span class="sd">        Staff-Measure-(Note or Rest or Chord) and Chord-Note)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="c1"># Staff can (in theory) contain many objects such as key signature</span>
            <span class="c1"># or time signature. We only rule out types that are</span>
            <span class="c1"># outside-of-hierarchy:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span> <span class="p">(</span><span class="n">Score</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">Staff</span><span class="p">,</span> <span class="n">Note</span><span class="p">,</span> <span class="n">Rest</span><span class="p">,</span> <span class="n">Chord</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span> <span class="n">Measure</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">measure</span><span class="o">.</span><span class="n">is_measured</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="Staff.remove_measures">
<a class="viewcode-back" href="../../../_autosummary/amads.core.basics.html#amads.core.basics.Staff.remove_measures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Staff&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify Staff by removing all Measures.  Notes are &quot;lifted&quot;</span>
<span class="sd">        from Measures to become direct content of this Staff. There is</span>
<span class="sd">        no special handling for notes tied to or from another Staff,</span>
<span class="sd">        so normally this method should be used only on a Staff where</span>
<span class="sd">        ties have been merged (see `merge_tied_notes()`).</span>
<span class="sd">        This method is normally called from `remove_measures()` in Part,</span>
<span class="sd">        which insures that this Staff is not shared, so it is safe to</span>
<span class="sd">        modify it. If called directly, the caller, to avoid unintended</span>
<span class="sd">        side effects, must ensure that this Staff is not shared data.</span>
<span class="sd">        Only Note and KeySignature objects are copied from Measures</span>
<span class="sd">        to the Staff. All other objects are removed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Staff</span>
<span class="sd">            A Staff with all Measures removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span> <span class="n">Measure</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">measure</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">(</span><span class="n">Note</span><span class="p">,</span> <span class="n">KeySignature</span><span class="p">)):</span>
                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                    <span class="c1"># else ignore the event</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># non-Measure objects are simply copied</span>
                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">new_content</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The AMADS team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2024, The AMADS team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>